!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";var __defProp=Object.defineProperty,__defNormalProp=(e,t,a)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,__publicField=(e,t,a)=>__defNormalProp(e,"symbol"!=typeof t?t+"":t,a);async function loadJsonFile(e){var t=e.replace(".csv","");if(jsonCache[t])return jsonCache[t];try{const e=await fetch(`/${t}.json`),a=await e.json();return jsonCache[t]=a,a}catch(a){return console.error("Error loading JSON:",a),null}}async function updateDescription(e){const{element:t,detail:a}=e;if(!a)return;const{rowId:n,csvFilename:o}=a;if(console.log("updateDescription",a),!n)return;if(!o)return;const s=await loadJsonFile(o);if(!s)return void console.error("No description available: CSV file not found. This is caused by missing CSV file, failed to convert to JSON, or failed to load from cache.");const r=s.find((e=>e.id===n));if(!r)return void console.error("No description available: Row not found");t.querySelectorAll(".description-field").forEach((e=>{e.textContent=r[e.dataset.columnName]}))}function initValidator(e,t){const a=e.name,n=global.schemas[a];console.log(a,n),n?e.addEventListener("input",(e=>{console.log(e);const a=validate(e.target.value,n);a.valid?(e.target.classList.remove("invalid"),t&&(t.textContent="")):(e.target.classList.add("invalid"),t&&(t.textContent=a.message))})):console.error(`No schema found for ${a}`)}function validate(e,t){var a;try{t.parse(e);return{valid:!0,message:""}}catch(n){return{valid:!1,message:(null==(a=error.errors[0])?void 0:a.message)||"入力が無効です"}}}function dispatchWrappedEvent(e,t){const a=function e(t){if(!t.classList.contains("event-wrapper"))return t;for(const a of t.children){const t=e(a);if(t)return t}return null}(e.currentTarget);if(!a)return;const n={...a.dataset},o=new CustomEvent(t,{bubbles:!0,detail:n});document.dispatchEvent(o)}globalThis.PARAM_TYPES={Bool:"Bool",Number:"Number",String:"String",Object:"Object",Array:"Array"},globalThis.Utils={EvalGetValue:function(value,key){let v;return eval("v = value"+key),v},EvalSetValue:function(value,key,newValue){let v=structuredClone(value);return eval("v"+key+" = newValue"),v},dictFullPathAdd:function(e,t,a){let n=structuredClone(e),o=n;t.startsWith(".")&&(t=t.slice(1));const s=t.split(".");return s.forEach(((e,t)=>{const n=e.match(/(\w+)\[(\d+)\]/);if(n){const[e,r,l]=n;o[r]||(o[r]=[]),t===s.length-1?o[r][l]=a:(o[r][l]||(o[r][l]={}),o=o[r][l])}else t===s.length-1?o[e]=a:(o[e]||(o[e]={}),o=o[e])})),n}},globalThis.jsonCache={},document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("description");for(const a of t){domUpdateHelper.registerCallback(a,updateDescription);const e=a.dataset.eventName;document.addEventListener(e,(e=>{const t={detail:e.detail};domUpdateHelper.executeCallbacks(a,t)}))}})),document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("validator-wrapper");for(const a of t){const e=a.querySelector("input"),t=a.querySelector(".validation-error");e?initValidator(e,t):console.error("No input element found in validator-wrapper",a)}})),document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementsByClassName("click-wrapper");for(const n of e){const e=n.dataset.eventName;n.addEventListener("click",(t=>dispatchWrappedEvent(t,e)))}const t=document.getElementsByClassName("hover-wrapper");for(const n of t){const e=n.dataset.eventName;n.addEventListener("mouseover",(t=>dispatchWrappedEvent(t,e)))}const a=document.getElementsByClassName("leave-wrapper");for(const n of a){const e=n.dataset.eventName;n.addEventListener("mouseout",(t=>dispatchWrappedEvent(t,e)))}})),document.addEventListener("DOMContentLoaded",(e=>{var t=document.getElementsByClassName("filebrowser");for(const a of t){const e=a.querySelector("button"),t=a.querySelector("input");console.assert(e,"FileBrowserはbuttonタグを含む必要があります"),console.assert(t,"FileBrowserはinputタグを含む必要があります"),e.addEventListener("click",(async e=>{const a=await eel.open_filebrowser()();t.value=a}))}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("rosparam");for(const t of e){console.assert(null!==t.getAttribute("name"),"Parameterのname属性が必要です.");const e=t.getAttribute("name"),a=new CustomEvent(ROS_EVENTS.Param,{detail:{name:e}});if(document.dispatchEvent(a),!t.hasAttribute("update-custom")){if(domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement),"DIV"===t.tagName){const a=t.querySelectorAll("input");for(const t of a)t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=t.currentTarget.getAttribute("data-key"),o=await ROSInterface.getParam(e),s=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Object,value:Utils.EvalSetValue(o,n,a)}});document.dispatchEvent(s)}))}"SELECT"===t.tagName&&t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})),"INPUT"===t.tagName&&("checkbox"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.checked,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Bool,value:a}});document.dispatchEvent(n)})):"radio"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})):"text"===t.type?t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.String,value:a}});document.dispatchEvent(n)})):t.addEventListener("change",(async t=>{const a=t.currentTarget.value,n=new CustomEvent(ROS_EVENTS.ParamSet,{detail:{name:e,type:PARAM_TYPES.Number,value:a}});document.dispatchEvent(n)})))}}document.addEventListener(ROS_EVENTS.ParamUpdated,(async e=>{const{name:t,value:a}=e.detail,n=document.querySelectorAll(`[name="${t}"][class="rosparam"]`);for(var o=0;o<n.length;o++)domUpdateHelper.executeCallbacks(n[o],{value:a})}))})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("publish");for(const t of e){const e=t.getAttribute("name");console.assert(e,"Publisherのname属性が必要です");const a=t.getAttribute("m-type");if(console.assert(a,"Publisherのext属性が必要です"),console.assert("DIV"===t.tagName,"PublisherはDIVタグである必要があります"),"DIV"!==t.tagName)continue;const n=t.querySelector("button");console.assert(n,"Publisherはbuttonタグを含む必要があります");const o=t.querySelectorAll("input");console.assert(o.length>0,"Publisherはinputタグを含む必要があります"),n.addEventListener("click",(async t=>{let n={};o.forEach((e=>{const t=e.getAttribute("ext");var a;t&&(a="checkbox"==e.type?e.checked:"number"==e.type||"radio"==e.type?Number(e.value):e.value,n=Utils.dictFullPathAdd(n,t,a))}));const s=new CustomEvent(ROS_EVENTS.Publish,{detail:{name:e,type:a,value:n}});document.dispatchEvent(s)}))}})),document.addEventListener("DOMContentLoaded",(async()=>{const e=document.getElementsByClassName("subscribe");for(const t of e){const e=t.getAttribute("name");console.assert(e,"Subscriberのname属性が必要です.");const a=t.getAttribute("m-type");if(console.assert(a,"Subscriberのm-type属性が必要です."),console.assert("DIV"===t.tagName,"SubscriberはDIVタグである必要があります."),"DIV"!==t.tagName)continue;const n=new CustomEvent(ROS_EVENTS.Subscribe,{detail:{name:e,type:a}});document.dispatchEvent(n),t.hasAttribute("update-custom")||domUpdateHelper.registerCallback(t,domUpdateHelper.updateElement)}document.addEventListener(ROS_EVENTS.SubscribedValue,(async e=>{const{name:t,value:a}=e.detail,n=document.querySelectorAll(`[name="${t}"][class="subscribe"]`);for(var o=0;o<n.length;o++)domUpdateHelper.executeCallbacks(n[o],{value:a})}))}));const _DOMUpdateHelper=class e{static registerCallback(t,a){e.updateCallbacks.has(t)?e.updateCallbacks.get(t).push(a):e.updateCallbacks.set(t,[a])}static executeCallbacks(t,a){e.updateCallbacks.has(t)&&e.updateCallbacks.get(t).forEach((e=>{e({element:t,...a})}))}static updateElement(t){const{element:a,value:n}=t;switch(a.tagName){case"DIV":e.updateDivElement(a,n);break;case"SELECT":e.updateSelectElement(a,n);break;case"INPUT":e.updateInputElement(a,n);break;case"IMG":e.updateImageElement(a,n);break;default:throw new Error(`Unsupported element tag: ${a.tagName}`)}}static updateDivElement(t,a){t.setAttribute("data-value",a);const n=t.children;for(const o of n)o.hasAttribute("ext")&&e.updateElement({element:o,value:Utils.EvalGetValue(a,o.getAttribute("ext"))})}static updateInputElement(e,t){"checkbox"!==e.type?"radio"!==e.type?e.value=t:e.checked=e.value===t:e.checked=t}static updateSelectElement(e,t){const a=e.querySelectorAll("option");for(let n=0;n<a.length;n++)a[n].selected=a[n].value===t}static updateImageElement(e,t){e.src=t}};__publicField(_DOMUpdateHelper,"updateCallbacks",new WeakMap);let DOMUpdateHelper=_DOMUpdateHelper;globalThis.domUpdateHelper=DOMUpdateHelper,window.addEventListener("unload",(async e=>{for(const t of publishButtons)eel.ros_unpublish(t.getAttribute("name"));for(const t of subscribeElements)eel.ros_unsubscribe(t.getAttribute("name"));for(const t of paramElements)eel.ros_unregister_param(t.getAttribute("name"))}))}));
//# sourceMappingURL=bundle.umd.cjs.map
